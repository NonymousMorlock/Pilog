{% extends "base.html" %}

{% block title %}Pilog - Map Visuals{% endblock %}

{% block extra_head %}
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
{% endblock %}

{% block content %}
  <h1>Map Visuals</h1>
  <p class="muted">Routes and airport activity from your logbook.</p>

  <div class="map-layout">
    <section class="card map-panel">
      <div class="map-toolbar">
        <label class="map-toggle">
          <input type="checkbox" id="toggleRoutes" {% if map_filters.show_routes %}checked{% endif %}>
          <span>Routes</span>
        </label>
        <label class="map-toggle">
          <input type="checkbox" id="toggleHeatmap" {% if map_filters.show_heatmap %}checked{% endif %}>
          <span>Heatmap</span>
        </label>
        <div class="map-slider">
          <label for="routeOpacity">Route opacity</label>
          <input id="routeOpacity" type="range" min="0.1" max="1" step="0.1" value="0.7">
        </div>
        <div class="map-slider">
          <label for="heatIntensity">Heat intensity</label>
          <input id="heatIntensity" type="range" min="0.2" max="2" step="0.1" value="1">
        </div>
      </div>
      <div id="mapCanvas" class="map-canvas" role="region" aria-label="Flight map"></div>
      <div id="mapNotice" class="map-notice muted"></div>
    </section>

    <aside class="map-sidebar">
      <div class="card map-card">
        <h2>Filters</h2>
        <div class="map-field">
          <label for="mapStart">Start date</label>
          <input id="mapStart" type="date" value="{{ map_filters.start or '' }}">
        </div>
        <div class="map-field">
          <label for="mapEnd">End date</label>
          <input id="mapEnd" type="date" value="{{ map_filters.end or '' }}">
        </div>
        <div class="map-field">
          <label for="mapAircraft">Aircraft</label>
          <select id="mapAircraft" multiple size="6"></select>
        </div>
        <div class="map-field">
          <label for="mapTags">Tags (coming soon)</label>
          <select id="mapTags" multiple size="4" disabled></select>
          <div class="muted">Tag filters are disabled until tagging is available.</div>
        </div>
        <button id="applyFilters" class="btn" type="button">Apply filters</button>
      </div>

      <div class="card map-card">
        <h2>Airport details</h2>
        <div id="airportDetail" class="map-detail">Select an airport marker to see details.</div>
      </div>

      <div class="card map-card">
        <h2>Data notes</h2>
        <div id="mapWarnings" class="map-warnings"></div>
        <div id="missingAirports" class="map-missing"></div>
        <div class="map-warning">Leaflet assets load from a CDN in this build.</div>
        {% if map_config.tile_external %}
        <div class="map-warning">
          Tiles load from an external server: <span class="muted">{{ map_config.tile_url }}</span>
        </div>
        {% endif %}
      </div>
    </aside>
  </div>

  <script id="mapData" type="application/json">{{ map_data|tojson }}</script>
  <script id="mapConfig" type="application/json">{{ map_config|tojson }}</script>
{% endblock %}

{% block scripts %}
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>
  <script src="/static/map.js"></script>
{% endblock %}
